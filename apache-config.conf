# Definir el administrador del servidor y dominios
ServerAdmin admin@transportesgodoy-nomina.xrom.cc
ServerName transportesgodoy-nomina.xrom.cc
ServerAlias www.transportesgodoy-nomina.xrom.cc

# Escuchar tráfico en puertos HTTP y HTTPS
Listen 80
Listen 443

# Cargar módulo MPM (para evitar error "No MPM loaded")
LoadModule mpm_event_module modules/mod_mpm_event.so
# Si se necesita prefork en vez de event, usa:
# LoadModule mpm_prefork_module modules/mod_mpm_prefork.so

# Cargar módulo de reescritura (para manejar rutas de React correctamente)
LoadModule rewrite_module modules/mod_rewrite.so

# Redirigir tráfico HTTP a HTTPS
<VirtualHost *:80>
    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

# Configuración de HTTPS
<VirtualHost *:443>
    DocumentRoot "/usr/local/apache2/htdocs"
    ServerName transportesgodoy-nomina.xrom.cc

    # Habilitar SSL
    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/ssl/_.xrom.cc.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/ssl/_.xrom.cc.key"

    # Configurar directorio de la aplicación
    <Directory "/usr/local/apache2/htdocs">
        AllowOverride All
        Require all granted

        # Reescribir rutas para React (react-router-dom)
        RewriteEngine On
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.html [L]
    </Directory>

    # Rutas correctas para logs
    ErrorLog "/usr/local/apache2/logs/error.log"
    CustomLog "/usr/local/apache2/logs/access.log" combined
</VirtualHost>
